{
    "mark": "iotm",
    "config": [
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "ipNet",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "Network",
            "descr": "IP",
            "int": "0",
            "val": "0.0",
            "map": "",
            "plus": 0,
            "multiply": 1,
            "round": 0,
            "moduleName": "Variable"
        },
        {
            "global": 0,
            "type": "Writing",
            "subtype": "Cron",
            "id": "cronWiFi",
            "widget": "anydataDef",
            "page": "Timers",
            "descr": "  cronWiFi",
            "int": 1,
            "val": "0 * * * * *",
            "formatNextAlarm": "%H:%M:%S",
            "needSave": 0,
            "moduleName": "Cron"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "VButton",
            "id": "wifiConn",
            "needSave": 0,
            "widget": "toggle",
            "page": "Network",
            "descr": "  Wi-Fi Connection",
            "int": "0",
            "val": "0",
            "moduleName": "VButton"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "noWiFiCounter",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "Network",
            "descr": "  noWiFi Counter",
            "int": "0",
            "val": "0.0",
            "map": "",
            "plus": 0,
            "multiply": 1,
            "round": 0,
            "moduleName": "Variable"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "maxNoWiFi",
            "needSave": 0,
            "widget": "inputDgt",
            "page": "Network",
            "descr": " maxNoWiFi to reboot",
            "int": "0",
            "val": "100",
            "map": "",
            "plus": 0,
            "multiply": 1,
            "round": 0,
            "moduleName": "Variable"
        },
        {
            "global": 0,
            "type": "Writing",
            "subtype": "Cron",
            "id": "cronPing",
            "widget": "anydataDef",
            "page": "Timers",
            "descr": " cronPing",
            "int": 1,
            "val": "2 * * * * *",
            "formatNextAlarm": "%H:%M:%S",
            "needSave": 0,
            "moduleName": "Cron"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Ping",
            "id": "pingN",
            "needSave": 0,
            "widget": "nil",
            "page": "Network",
            "descr": "Internet",
            "ip": "8.8.8.8",
            "timeout": 5,
            "interval": "1",
            "data_size": 0,
            "count": 0,
            "tos": 0,
            "moduleName": "Ping"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "noInternetCounter",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "Network",
            "descr": "noInternet Counter",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0,
            "moduleName": "Variable"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "VButton",
            "id": "internetConn",
            "needSave": 0,
            "widget": "toggle",
            "page": "Network",
            "descr": "Internet Connection",
            "int": "0",
            "val": "0",
            "moduleName": "VButton"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "routerFlag0",
            "needSave": 0,
            "widget": "nil",
            "page": "nil",
            "descr": "routerFlag0",
            "int": "0",
            "val": "0.0",
            "map": "",
            "plus": 0,
            "multiply": 1,
            "round": 0,
            "moduleName": "Variable"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "routerFlag1",
            "needSave": 0,
            "widget": "nil",
            "page": "nil",
            "descr": "routerFlag1",
            "int": "0",
            "val": "0.0",
            "map": "",
            "plus": 0,
            "multiply": 1,
            "round": 0,
            "moduleName": "Variable"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "routerFlag3",
            "needSave": 0,
            "widget": "nil",
            "page": "nil",
            "descr": "routerFlag3",
            "int": "0",
            "val": "0.0",
            "map": "",
            "plus": 0,
            "multiply": 1,
            "round": 0,
            "moduleName": "Variable"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "VButton",
            "id": "vbtnWOLbook",
            "needSave": 0,
            "widget": "toggle",
            "page": "WakeOnLAN",
            "descr": "Wake Notebook scenario",
            "int": "0",
            "val": "0",
            "moduleName": "VButton",
            "show": true
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "WakeOnLanModule",
            "id": "wakeLanBook",
            "widget": "toggle",
            "page": "WakeOnLAN",
            "descr": "Wake Notebook w.settings",
            "MAC": "\"A0:AD:A8:A2:AF:E2\"",
            "SecureOn": "",
            "port": 9,
            "repeats": 3,
            "moduleName": "WakeOnLanModule",
            "show": true
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "macInput",
            "needSave": 0,
            "widget": "inputTxt",
            "page": "WakeOnLAN",
            "descr": "MAC Input",
            "int": "0",
            "val": "A0:AD:A8:A2:AF:E2",
            "moduleName": "Variable"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "bootDateNet",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "Time",
            "descr": " Boot Date",
            "int": "0",
            "val": "0.0",
            "map": "",
            "plus": 0,
            "multiply": 1,
            "round": 0,
            "moduleName": "Variable"
        }
    ]
}

scenario=>if onStart then {
ipNet = getIP()
pingN.ping("8.8.8.8")
bootDateNet=getTime()
}


#book
 if vbtnWOLbook == 1 then {
wakeLanBook.mac(macInput)
 vbtnWOLbook = 0
}


######################
if cronWiFi then ipNet = getIP()

if ipNet == "(IP unset)" | ipNet == "192.168.4.1" then {
wifiConn = 0 
noWiFiCounter = noWiFiCounter +1
}else {
wifiConn = 1
noWiFiCounter = 0
}

if noWiFiCounter > maxNoWiFi then reboot()

###################
if cronPing then {
pingN.ping("8.8.8.8")
}

if pingN == 0 then {
internetConn = 0 
noInternetCounter = noInternetCounter +1
}else {
internetConn = 1
#noInternetCounter = 0
noInternetCounter = noInternetCounter +1
}
