{
    "mark": "iotm",
    "config": [
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "boilerConnected",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–°—Ç–∞—Ç—É—Å –∫–æ—Ç–ª–∞",
            "descr": "‚úî –°–≤—è–∑—å —Å –∫–æ—Ç–ª–æ–º",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "burner",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–°—Ç–∞—Ç—É—Å –∫–æ—Ç–ª–∞",
            "descr": "üî• –ì–æ—Ä–µ–ª–∫–∞",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "heating",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–°—Ç–∞—Ç—É—Å –∫–æ—Ç–ª–∞",
            "descr": "‚ò¢ –ö–æ–Ω—Ç—É—Ä –æ—Ç–æ–ø–ª–µ–Ω–∏—è",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "dhw",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–°—Ç–∞—Ç—É—Å –∫–æ—Ç–ª–∞",
            "descr": "üõÅ –ö–æ–Ω—Ç—É—Ä –ì–í–°",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": "1",
            "type": "Reading",
            "subtype": "Variable",
            "id": "tempCH",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–ö–æ—Ç—ë–ª",
            "descr": "üå°Ô∏è –¢–µ–ø–ª–æ–Ω–æ—Å–∏—Ç–µ–ª—è",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": "1",
            "type": "Reading",
            "subtype": "Variable",
            "id": "tempDHW",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–ö–æ—Ç—ë–ª",
            "descr": "üå°Ô∏è –ì–í–°",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "VButton",
            "id": "setStatusCH",
            "needSave": "0",
            "widget": "toggle",
            "page": "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ",
            "descr": "‚ò¢ –û—Ç–æ–ø–ª–µ–Ω–∏–µ (–≤–∫–ª/–≤—ã–∫–ª)",
            "int": "0",
            "val": "0"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "VButton",
            "id": "setStatusDHW",
            "needSave": "0",
            "widget": "toggle",
            "page": "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ",
            "descr": "üõÅ –ì–≤—Å (–≤–∫–ª/–≤—ã–∫–ª)",
            "int": "0",
            "val": "0"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "setTCH",
            "needSave": "0",
            "widget": "inputDgt",
            "page": "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ",
            "descr": "üå°Ô∏è –£—Å—Ç–∞–≤–∫–∞ –æ—Ç–æ–ø–ª–µ–Ω–∏—è",
            "int": "0",
            "val": "0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": "1",
            "type": "Reading",
            "subtype": "Ds18b20",
            "id": "temp",
            "widget": "anydataTmp",
            "page": "–¢–µ—Ä–º–æ—Å—Ç–∞—Ç",
            "descr": "üå°Ô∏è –í –ø–æ–º–µ—â–µ–Ω–∏–∏",
            "int": "120",
            "pin": "15",
            "index": "0",
            "addr": "28163C0D000000CF",
            "round": "1"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "SetTempId",
            "needSave": "1",
            "widget": "inputDgt",
            "page": "–¢–µ—Ä–º–æ—Å—Ç–∞—Ç",
            "descr": "üå°Ô∏è –ñ–µ–ª–∞–µ–º–∞—è",
            "int": "0",
            "val": "23",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "setDHW",
            "needSave": "1",
            "widget": "inputDgt",
            "page": "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ",
            "descr": "üå°Ô∏è –£—Å—Ç–∞–≤–∫–∞ –ì–í–°",
            "int": "0",
            "val": "0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "pressure",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–°—Ç–∞—Ç—É—Å –∫–æ—Ç–ª–∞",
            "descr": "üíß –î–∞–≤–ª–µ–Ω–∏–µ",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": "2"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "codeError",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–ö–æ—Ç—ë–ª",
            "descr": "üö® –û—à–∏–±–∫–∞ –∫–æ—Ç–ª–∞",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "lasttemp",
            "needSave": 0,
            "widget": "nil",
            "page": "–í–≤–æ–¥",
            "descr": "–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ",
            "int": "0",
            "val": "0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0,
            "moduleName": "Variable"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "VButton",
            "id": "auto",
            "needSave": "1",
            "widget": "toggle",
            "page": "–¢–µ—Ä–º–æ—Å—Ç–∞—Ç",
            "descr": "–¢–µ—Ä–º–æ—Å—Ç–∞—Ç (–≤–∫–ª/–≤—ã–∫–ª",
            "int": "0",
            "val": "0",
            "moduleName": "VButton"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "tempOT",
            "needSave": 0,
            "widget": "nil",
            "page": "–í–≤–æ–¥",
            "descr": "–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ",
            "int": "0",
            "val": "0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0,
            "moduleName": "Variable"
        },
        {
            "global": 0,
            "type": "Writing",
            "subtype": "TelegramLT",
            "id": "tg",
            "widget": "",
            "page": "",
            "descr": "",
            "token": "",
            "chatID": "",
            "moduleName": "TelegramLT"
        },
        {
            "global": "1",
            "needSave": "0",
            "type": "Writing",
            "subtype": "ThermostatPID",
            "id": "Thermo96",
            "widget": "anydataTmp",
            "page": "–¢–µ—Ä–º–æ—Å—Ç–∞—Ç",
            "descr": "üå°Ô∏è –†–∞—Å—á–µ—Ç–Ω–∞—è",
            "int": "10",
            "round": 1,
            "map": "1024,1024,1,100",
            "set_id": "SetTempId",
            "term_id": "temp",
            "rele": "",
            "setDirection": 0,
            "setLimitsMIN": "20",
            "setLimitsMAX": "60",
            "KP": 10,
            "KI": "0.01",
            "KD": "8",
            "moduleName": "Thermostat"
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "UpdateServer",
            "id": "UpdateServer38",
            "widget": "",
            "page": "",
            "descr": "",
            "btn-startUpdateAll": "http://192.168.0.84:5500/iotm/esp32c6_8mb/400/",
            "btn-startUpdateFS": "",
            "btn-startUpdateFW": ""
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "tSetCH",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è",
            "descr": "üå°Ô∏è –û—Ç–æ–ø–ª–µ–Ω–∏—è",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "tSetDHW",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è",
            "descr": "üå°Ô∏è –ì–í–°",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "writtenHeatingEnabled",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è",
            "descr": "–û—Ç–æ–ø–ª–µ–Ω–∏–µ (–≤–∫–ª/–≤—ã–∫–ª)",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "writtenDHWEnabled",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è",
            "descr": "–ì–í–° (–≤–∫–ª/–≤—ã–∫–ª)",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "Variable",
            "id": "setMaxModLevel",
            "needSave": 0,
            "widget": "anydataDef",
            "page": "–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è",
            "descr": "–ú–æ–¥—É–ª—è—Ü–∏—è",
            "int": "0",
            "val": "0.0",
            "map": "1024,1024,1,100",
            "plus": 0,
            "multiply": 1,
            "round": 0
        },
        {
            "global": 0,
            "type": "Reading",
            "subtype": "ecAdapter",
            "id": "ecto",
            "widget": "nil",
            "page": "–ö–æ—Ç—ë–ª",
            "descr": "–ê–¥–∞–ø—Ç–µ—Ä",
            "int": "20",
            "addr": "23",
            "RX": "11",
            "TX": "10",
            "DIR_PIN": "0",
            "baud": 19200,
            "protocol": "SERIAL_8N1",
            "debug": "0",
            "UARTLine": "1"
        }
    ]
}

scenario=>if onStart then {
tg.sendOftenMsg("E-bus  http://" + getIP());
if auto then {Thermo96.enable(1);} else {Thermo96.enable(0);}
}

#–≤–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–æ–ø–ª–µ–Ω–∏—è
if setStatusCH == 1 then ecto.setHeating(1);
if setStatusCH == 0 then ecto.setHeating(0);

#–≤–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ì–í–°
if setStatusDHW == 1 then ecto.setDHW(1);
if setStatusDHW == 0 then ecto.setDHW(0);

#setStatusCH2
if setStatusCH2 == 1 then ecto.setSecondaryCircuit(1);
if setStatusCH2 == 0 then ecto.setSecondaryCircuit(0);

#–£—Å—Ç–∞–Ω–æ–≤–∫–∞ üå°Ô∏è–ì–í–°
if setDHW then ecto.setTDHW (setDHW);
#–£—Å—Ç–∞–Ω–æ–≤–∫–∞ üå°Ô∏è —Ç–µ–ø–ª–æ–Ω–æ—Å–∏—Ç–µ–ª—è
if setTCH then ecto.setTCH (setTCH);

#–í–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç–∞ –ø–∏–¥
if auto == 1 then Thermo96.enable(1);

#–í—ã–ª—é—á–µ–Ω–∏–µ —Ç–µ—Ä–º–æ—Å—Ç–∞—Ç–∞ –ø–º–¥
if auto == 0 then {
Thermo96.enable(0);
tempOT = 20;
}

if Thermo96 > 38 then tempOT = Thermo96 else tempOT = 20;

#–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
if tempOT != lasttemp then lasttemp = tempOT;
if lasttemp then ecto.setTCH (lasttemp);

#—Å—á–∏—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ –∞–¥–∞–ø—Ç–µ—Ä –∑–Ω–∞—á–µ–Ω–∏–π
if writtenHeatingEnabled then setStatusCH := writtenHeatingEnabled;
if writtenDHWEnabled then setStatusDHW := writtenDHWEnabled;
if tSetDHW then setDHW := tSetDHW;
if tSetCH then setTCH := tSetCH;

#—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ç–µ–ª–µ–≥—Ä–∞–º
if  codeError > 1 then tg.sendMsg("üö® –û—à–∏–±–∫–∞ –∫–æ—Ç–ª–∞ F" + codeError);
if  boilerConnected == 0 then tg.sendMsg("üö® –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–≤—è–∑—å —Å –∫–æ—Ç–ª–æ–º") else tg.sendMsg("C–≤—è–∑—å —Å –∫–æ—Ç–ª–æ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞") ;
if  pressure < 0.9 then tg.sendMsg("üíß –ù–∏–∑–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–ø–ª–æ–Ω–æ—Å–∏—Ç–µ–ª—è" + pressure);